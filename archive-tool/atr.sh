#!/bin/bash

# Проверка количества аргументов
if [ $# -ne 2 ]; then
  echo "Использование: $0 <путь к папке> <имя архива>"
  echo "Опции:"
  echo "  -h  Вывод справки"
  echo "  -v  Вывод подробной информации"
  exit 1
fi

# Обработка опций
while getopts ":hv" opt; do
  case $opt in
    h)
      echo "Использование: $0 <путь к папке> <имя архива>"
      echo "Опции:"
      echo "  -h  Вывод справки"
      echo "  -v  Вывод подробной информации"
      exit 0
      ;;
    v)
      verbose=1
      ;;
    \?)
      echo "Недопустимая опция: -$OPTARG"
      exit 1
      ;;
  esac
done

# Упаковка папки в zip
if [ $verbose -eq 1 ]; then
  echo "Упаковка папки $1 в архив $2..."
fi
zip -r "$2" "$1"

# Тестирование архива
if [ $verbose -eq 1 ]; then
  echo "Тестирование архива $2..."
fi
unzip -t "$2"

# Если тест прошел успешно, удалить папку
if [ $? -eq 0 ]; then
  if [ $verbose -eq 1 ]; then
    echo "Удаление папки $1..."
  fi
  rm -rf "$1"
  echo "Папка упакована и удалена"
else
  echo "Ошибка при упаковке или тестировании архива"
fi
